\section{Synchronisation}

\subsection{Race Condition}
mehrere parallele Threads/Prozesse nutzen \textbf{gemeinsame Resource}.\\
Zustand hängt von Ausführung ab:\\
$\Rightarrow$ \textbf{nicht vorhersagbar, nicht reproduzierbar}

\subsection{Synchronisationsmechanismen}
\begin{itemize}
    \item Mutex
    \item Semaphor
    \begin{itemize}
        \item negativ Werte: immer um 1 erhöhen und erniedrigen
    \end{itemize}
    \item Event (wie Condition Variable)
    \begin{itemize}
        \item automatisch: ein Thread kehrt zurück -> reset
        \item manuell: alle Threads kehren zurück
    \end{itemize}
    \item Monitor (Klasse bei der Jede public Methode Synchronisiert ist)
    \item Locking
    \begin{itemize}
        \item Concurrent Read
        \item Concurrent Write
        \item Protected Read
        \item Protected Write
        \item Exclusive
    \end{itemize}
\end{itemize}

\subsection{Spin-Locks}
\begin{itemize}
    \item Prozess/Thread geht nicht in blockiert Zustand:\\
    $\Rightarrow$ in Interrupt Handlern Verwendbar
    \item nicht rekursiv
    \item nur bei kurzen wartezeiten    
\end{itemize}

\subsection{Anforderungen}
\begin{itemize}
    \item kein Deadlock (blockiert außerhalb v. kritischem Bereich)
    \item Starvation free (Scheduling bei mehreren Wartenden)
\end{itemize}

\subsection{Deadlocks}
Ein Zustand in dem Jeder Teilnehmer auf einen Anderen wartet (Alle warten gegenseitig aufeinander).

\subsubsection{Vorraussetzungen}
\begin{itemize}
    \item Mutual Exclusion (mindestens eine Resource nur exklusiv verfügbar)
    \item Hold and Wait (hat resource, wartet auf andere resource)
    \item No preemption (resource kann nur von Prozess abgegeben werden)
    \item Circular Wait (Geschlossener kreis beim Warten auf Resourcen)
\end{itemize}

\subsection{Bakner's Algorithm}
\begin{itemize}
    \item geg: Allocation (Prozess <-> Resource), Max, Available
    \item Algorithmus:
    \begin{enumerate}
        \item Need = Max - Allocation
        \item While unscheduled Processes exist
        \begin{enumerate}
            \item Select unscheduled Process
            \item If Need <= Available
            \begin{itemize}
                \item Available + Allocation = Available
            \end{itemize}
        \end{enumerate}
    \end{enumerate}
\end{itemize}

\subsection{Praxis (Linux)}
\begin{itemize}
    \item Atomare:
    \begin{itemize}
        \item Integer-Variablen
        \item Bit-Operationen
    \end{itemize}
    \item Spin-Locks
    \item Reader-Writer-Locks
    \item Semaphore/R-W-Semaphore
    \item Mutexe
\end{itemize}

\subsection{Linux-Kernel: Semaphore}
\begin{lstlisting}
    sema_init(&sem, count);
    init_MUTEX(&sem);
    down(&sem)
        /* kritischer Bereich */
    up(&sem);
\end{lstlisting}